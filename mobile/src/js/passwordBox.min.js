var pwdBox = {
    template: '<div class="inner-box" >' + '<span class="iconfont icon-guanbi close">×</span>' + '<h1 class="title pwd-title">支付密码</h1>' + '<div class="flexable password">' + '<div >●</div>' + '<div >●</div>' + '<div >●</div>' + '<div >●</div>' + '<div >●</div>' + '<div >●</div>' + '<!--●-->' + '</div>' + '<div class="notice color-lightblue">请输入支付密码！</div>' + '<div class="input-box">' + '<div class="flexable">' + '<div class="input-key" data-label="1" ></div><div class="input-key" data-label="2"></div><div class="input-key"  data-label="3"></div>' + '</div>' + '<div class="flexable">' + '<div class="input-key" data-label="4" ></div><div class="input-key" data-label="5"></div><div class="input-key" data-label="6"></div>' + '</div>' + '<div class="flexable">' + '<div class="input-key" data-label="7" ></div><div class="input-key" data-label="8"></div><div class="input-key" data-label="9"></div>' + '</div>' + '<div class="flexable">' + '<div></div><div class="input-key" data-label="0" ></div><div class="input-key" data-label="del"  ></div>' + '</div>' + '</div>' + '</div>',
    passwordOrg: '',
    password: '',
    inited: false,
    callback: function(res) {
        if (res) {
            alert('密码正确');
            document.querySelector('.password-box').style.display = 'none'
        } else {
            alert('密码错误')
        }
    },
    init: function(password, keyboard, title, notice) {
        if (pwdBox.inited) {
            return
        }
        /*console.log(document.getElementsByTagName('body'));
        document.getElementsByTagName('body')[0].innerHTML += pwdBox.template;*/
        var pwdBoxHtml = document.createElement("div");
        pwdBoxHtml.className = "password-box";
        pwdBoxHtml.innerHTML = pwdBox.template;
        document.getElementsByTagName('body')[0].appendChild(pwdBoxHtml);
        if (keyboard) {
            document.querySelector('.password-box .inner-box').style.backgroundImage = keyboard
        }
        title && (document.querySelector('h1.title').innerText = title);
        notice && (document.querySelector('.password-box .notice').innerText = notice);
        password && (pwdBox.passwordOrg = password);
        document.querySelector('.close').addEventListener('click', function() {
            document.querySelector('.password-box').style.display = 'none';
            pwdBox.reset()
        });
        var inputs = document.querySelectorAll('.input-key');
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].addEventListener('touchstart', function(e) {
                onTouch(this.getAttribute('data-label'))
            }, true)
        }
        var onTouch = function(label) {
            if (label == 'del') {
                pwdBox.password = pwdBox.password.substr(0, pwdBox.password.length - 1);
                pwdBox.onChange()
            } else {
                pwdBox.password += label;
                if ( pwdBox.password.length > 6 ){
                    pwdBox.password = pwdBox.password.substring(0,6);
                    return false;
                }
                pwdBox.onChange();
                var timerId = setTimeout(function() {
                    clearTimeout(timerId)
                    if (pwdBox.password.length == 6) {
                        if (pwdBox.passwordOrg) {
                            if (pwdBox.password == pwdBox.passwordOrg) {
                                pwdBox.callback({
                                    status: true,
                                    password: pwdBox.password
                                })
                            } else {
                                pwdBox.callback({
                                    status: false,
                                    password: pwdBox.password
                                })
                            }
                        } else {
                            pwdBox.callback({
                                status: true,
                                password: pwdBox.password
                            })
                        }
                    }
                }, 0)
                // if (pwdBox.password.length == 6) {
                //     if (pwdBox.passwordOrg) {
                //         if (pwdBox.password == pwdBox.passwordOrg) {
                //             pwdBox.callback({
                //                 status: true,
                //                 password: pwdBox.password
                //             })
                //         } else {
                //             pwdBox.callback({
                //                 status: false,
                //                 password: pwdBox.password
                //             })
                //         }
                //     } else {
                //         pwdBox.callback({
                //             status: true,
                //             password: pwdBox.password
                //         })
                //     }
                // }
            }
        };
        pwdBox.inited = true
    },
    onChange: function() {
        var texts = document.querySelectorAll('.password>div');
        for (var i = 0; i < texts.length; i++) {
            texts[i].style.opacity = 0
        }
        for (i = 0; i < pwdBox.password.length; i++) {
            texts[i].style.opacity = 1
        }
    },
    reset: function() {
        pwdBox.password = '';
        pwdBox.inited = false;
        pwdBox.onChange();
        var _box = document.getElementsByClassName("password-box")[0];
        document.getElementsByTagName("body")[0].removeChild(_box);
        //document.querySelector('.password-box').style.display = 'none'
    },
    show: function(callback) {
        if (callback) {
            pwdBox.callback = callback
        }
        document.querySelector('.password-box').style.display = 'block'
    }
};

export default pwdBox;